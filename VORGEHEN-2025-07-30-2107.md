# üìã VORGEHENSDOKUMENT - SBV Professional V2 Implementierung

> **Dokument erstellt:** 2025-07-30 21:07:52  
> **Projekt:** SBV Professional V2 - Schweizer Bauernverband  
> **Verantwortlich:** Development Team  
> **Status:** IMPLEMENTIERUNG GESTARTET

## üéØ IMPLEMENTIERUNGSZIEL

Transformation der SBV-App von einem Demo-System mit hartcodierten Daten zu einer voll funktionsf√§higen Marketing-Projekt-Management-Plattform f√ºr den Schweizer Bauernverband.

## üìÖ ZEITPLAN

### Start: 2025-07-30, 21:07 Uhr
### Phase 1 Ende: 2025-08-02, 18:00 Uhr
### MVP Ziel: 2025-08-20
### Production: 2025-09-30

## üîÑ VORGEHEN PHASE 1: KRITISCHE FIXES

### 1Ô∏è‚É£ **TASK 1.1: Rapport-Frontend Reparatur** 
**Start:** 2025-07-30, 21:10 Uhr

#### Aktionen:
1. **21:10-21:20** - Analyse rapport.html und Identifikation der Demo-Daten-Stellen
2. **21:20-21:40** - Implementierung loadRapporte() Funktion
3. **21:40-22:00** - displayRapporte() anpassen f√ºr echte Daten
4. **22:00-22:20** - updateKPIDashboard() mit Backend verbinden
5. **22:20-22:30** - Testing und Debugging

#### Erfolgskriterien:
- [ ] Rapport-Seite zeigt echte Daten aus der Datenbank
- [ ] KPI-Dashboard zeigt korrekte Zahlen
- [ ] Filter funktionieren mit echten Daten
- [ ] Keine Console-Errors

### 2Ô∏è‚É£ **TASK 1.2: Gesuch-System Flexibilit√§t**
**Start:** 2025-07-31, 09:00 Uhr

#### Aktionen:
1. **09:00-09:15** - Migration 004 erstellen (Trigger entfernen)
2. **09:15-09:45** - API-Endpoints f√ºr flexible Teilprojekte
3. **09:45-10:30** - Frontend UI f√ºr Teilprojekt-Verwaltung
4. **10:30-11:00** - Integration Testing

#### Erfolgskriterien:
- [ ] Admin kann 1-10 Teilprojekte erstellen
- [ ] Teilprojekt-Namen frei w√§hlbar
- [ ] Keine automatischen 6 Altersgruppen mehr
- [ ] UI intuitiv bedienbar

### 3Ô∏è‚É£ **TASK 1.3: Rapport-Gesuch Verkn√ºpfung**
**Start:** 2025-07-31, 14:00 Uhr

#### Aktionen:
1. **14:00-14:30** - Teilprojekt-Dropdown in Rapport-Formular
2. **14:30-15:00** - Backend-Integration f√ºr Dropdown
3. **15:00-15:30** - Speichern mit teilprojekt_id
4. **15:30-16:00** - Anzeige in Rapport-√úbersicht

## üìä TRACKING-METHODE

### St√ºndliche Updates:
```markdown
#### UPDATE [ZEIT]:
- Status: [In Arbeit/Abgeschlossen/Blockiert]
- Fortschritt: [Prozent]
- N√§chste Schritte: [Beschreibung]
- Probleme: [Falls vorhanden]
```

### T√§glicher Report:
- Erledigte Tasks
- Offene Punkte
- Blocker
- Zeitplan-Status

## üõ†Ô∏è TECHNISCHE SPEZIFIKATIONEN

### Rapport-API Integration:
```javascript
// Ort: frontend/pages/rapport.html
// Zeile: ~1782 (in loadRapporte function)

const API_BASE_URL = window.API_BASE_URL || '';
const token = localStorage.getItem('authToken');

async function loadRapporte() {
    try {
        const response = await fetch(`${API_BASE_URL}/api/rapporte`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) throw new Error('Failed to load rapporte');
        
        const data = await response.json();
        displayRapporte(data.rapporte);
        updateKPIDashboard(data.rapporte);
    } catch (error) {
        console.error('Error loading rapporte:', error);
        showErrorMessage('Fehler beim Laden der Rapporte');
    }
}
```

### Flexible Teilprojekte Migration:
```sql
-- Migration: 004_flexible_teilprojekte.sql
-- Entfernt automatische Teilprojekt-Erstellung

BEGIN;

-- Trigger entfernen
DROP TRIGGER IF EXISTS create_teilprojekte_after_gesuch ON gesuche;
DROP FUNCTION IF EXISTS create_default_teilprojekte();

-- Neue API-Berechtigungen
COMMENT ON TABLE teilprojekte IS 'Flexible Marketing-Teilprojekte (1-10 pro Gesuch)';

COMMIT;
```

## üö® RISIKEN & MITIGATIONEN

### Risiko 1: Daten-Migration
- **Problem:** Bestehende Daten mit festen Teilprojekten
- **L√∂sung:** Migrations-Script f√ºr Datenkonvertierung

### Risiko 2: Frontend-Komplexit√§t
- **Problem:** Gro√üe monolithische HTML-Dateien
- **L√∂sung:** Schrittweise Refactoring w√§hrend Implementierung

### Risiko 3: Test-Coverage
- **Problem:** Keine existierenden Tests
- **L√∂sung:** Tests parallel zur Implementierung schreiben

## üìà FORTSCHRITTS-METRIKEN

### Phase 1 Ziele:
- **Code-Zeilen ge√§ndert:** ~500-800
- **API-Calls implementiert:** 8-10
- **UI-Komponenten:** 5-7
- **Test-Coverage:** Mindestens 30%

### Erfolgs-Indikatoren:
1. Rapport-Seite zeigt echte Daten ‚úÖ
2. Gesuch-System ist flexibel ‚úÖ
3. Keine kritischen Bugs ‚úÖ
4. Performance unter 2s Ladezeit ‚úÖ

## üîÑ KOMMUNIKATION

### Update-Frequenz:
- **St√ºndlich:** Fortschritts-Updates in diesem Dokument
- **T√§glich:** Summary per E-Mail/Slack
- **W√∂chentlich:** Demo & Review Meeting

### Eskalation:
- **Blocker > 2 Stunden:** Sofort melden
- **Zeitplan-Verz√∂gerung:** Innerhalb 1 Stunde
- **Kritische Bugs:** Sofort + Workaround

## ‚úÖ ABNAHME-KRITERIEN

### Phase 1 gilt als abgeschlossen wenn:
1. Alle Checkboxen im Umsetzungsplan Phase 1 ‚úÖ
2. Keine kritischen Bugs in Production
3. Performance-Tests bestanden
4. Code-Review durchgef√ºhrt
5. Dokumentation aktualisiert

---

**Dokument-Version:** 1.0  
**Letzte Aktualisierung:** 2025-07-30 21:07:52  
**N√§chste Review:** 2025-07-31 09:00 Uhr

## üìù IMPLEMENTIERUNGS-LOG

### 2025-07-30, 21:07
- Vorgehensdokument erstellt
- Implementierung beginnt mit Task 1.1: Rapport-Frontend Reparatur
- Ziel: Rapport-Seite mit echten Daten bis 22:30 Uhr

### UPDATE 21:45
- Status: Task 1.1 ABGESCHLOSSEN ‚úÖ
- Fortschritt: 100%
- Implementierte √Ñnderungen:
  - rapport.html zeigt jetzt echte Daten aus der Datenbank
  - Tabellen-Header angepasst (Teilprojekt, Gesuch, Ersteller, etc.)
  - displayRapporte() Funktion aktualisiert f√ºr Backend-Daten
  - KPI-Dashboard zeigt Rapport-Statistiken statt Budget
  - Teilprojekt-Filter wird dynamisch geladen
  - Action-Buttons (View/Edit/Delete) implementiert
  - Delete-Route im Backend hinzugef√ºgt
- N√§chste Schritte: Task 1.2 - Gesuch-System Flexibilit√§t

### Erfolgskriterien Task 1.1: ‚úÖ ERF√úLLT
- [x] Rapport-Seite zeigt echte Daten aus der Datenbank
- [x] KPI-Dashboard zeigt korrekte Zahlen (Rapport-Statistiken)
- [x] Filter funktionieren mit echten Daten
- [x] Keine Console-Errors (alle fehlenden Funktionen implementiert)

### UPDATE 2025-07-30, 22:15
- Status: Task 1.2 ABGESCHLOSSEN ‚úÖ
- Fortschritt: 100%
- Implementierte √Ñnderungen:
  - Migration 004_flexible_teilprojekte.sql erstellt
  - Automatische Teilprojekt-Erstellung entfernt
  - API-Endpoints f√ºr flexible Teilprojekte hinzugef√ºgt
  - Frontend UI f√ºr Teilprojekt-Verwaltung implementiert
  - Modal f√ºr Teilprojekt-Details (Name, Budget, Daten, Zielgruppe)
  - CRUD-Operationen f√ºr Teilprojekte funktionsf√§hig
- Erfolgskriterien Task 1.2: ‚úÖ ERF√úLLT
  - [x] Admin kann 1-10 Teilprojekte erstellen
  - [x] Teilprojekt-Namen frei w√§hlbar
  - [x] Keine automatischen 6 Altersgruppen mehr
  - [x] UI intuitiv bedienbar

### UPDATE 2025-07-30, 22:30
- Status: Task 1.3 ABGESCHLOSSEN ‚úÖ
- Fortschritt: 100%
- Implementierte √Ñnderungen:
  - Teilprojekt-Dropdown in Rapport-Formular hinzugef√ºgt
  - Dropdown l√§dt genehmigte Teilprojekte aus allen aktiven Gesuchen
  - Teilprojekte werden nach Gesuch gruppiert (optgroup)
  - rapport.html speichert jetzt teilprojekt_id statt category
  - Edit-Funktion l√§dt Teilprojekte und w√§hlt das richtige aus
  - Filter-Dropdown wird beim Seitenaufruf geladen
- Erfolgskriterien Task 1.3: ‚úÖ ERF√úLLT
  - [x] Teilprojekt-Dropdown in Rapport-Formular
  - [x] Backend-Integration f√ºr Dropdown
  - [x] Speichern mit teilprojekt_id
  - [x] Anzeige in Rapport-√úbersicht

## üìä PHASE 1 ZUSAMMENFASSUNG

### Abgeschlossene Tasks:
1. ‚úÖ **Task 1.1: Rapport-Frontend Reparatur** - Rapporte zeigen echte Daten
2. ‚úÖ **Task 1.2: Gesuch-System Flexibilit√§t** - 1-10 flexible Marketing-Teilprojekte
3. ‚úÖ **Task 1.3: Rapport-Gesuch Verkn√ºpfung** - Rapporte mit Teilprojekten verkn√ºpft

### Erreichte Ziele:
- Rapport-System zeigt echte Daten aus der Datenbank
- Flexibles Teilprojekt-System f√ºr Marketing-Projekte
- Vollst√§ndige Verkn√ºpfung zwischen Rapporten und Teilprojekten
- Intuitive Admin-Oberfl√§che f√ºr Teilprojekt-Verwaltung

### N√§chste Schritte (Phase 2):
- Webhook-Integration mit n8n
- Zusatzfelder f√ºr K-Ziele und Jahresvergleich
- Tests schreiben (30% Coverage)
- Environment Setup & Security

### UPDATE 2025-07-30, 23:00
- Status: Task 2.1 (Webhook-Integration) ABGESCHLOSSEN ‚úÖ
- Fortschritt: 100%
- Implementierte √Ñnderungen:
  - Webhook-Service f√ºr n8n-Integration erstellt
  - Unterst√ºtzung f√ºr `gesuch.submitted` und `teilprojekt.approved` Events
  - HMAC-Signatur f√ºr sichere Webhook-Verifizierung
  - Webhook-Logs Tabelle f√ºr Audit-Trail (Migration 005)
  - Integration in Gesuch-Routes (Submit & Approve)
  - Admin-Interface f√ºr Webhook-Verwaltung
  - Test-Endpoint und Retry-Funktionalit√§t
  - Umfassende Dokumentation (WEBHOOK-INTEGRATION.md)
  - .env.example mit Webhook-Konfiguration
- Erfolgskriterien: ‚úÖ ERF√úLLT
  - [x] Webhook wird bei Gesuch-Einreichung ausgel√∂st
  - [x] Webhook wird bei Teilprojekt-Genehmigung ausgel√∂st
  - [x] Admin kann Webhooks verwalten und testen
  - [x] Fehlerbehandlung und Retry-Mechanismus
  - [x] Vollst√§ndige Dokumentation

## üìä AKTUELLER STAND

### Abgeschlossene Features:
1. ‚úÖ Rapport-Frontend mit echten Daten
2. ‚úÖ Flexibles Gesuch-System (1-10 Teilprojekte)
3. ‚úÖ Rapport-Gesuch Verkn√ºpfung
4. ‚úÖ Webhook-Integration mit n8n

### Noch zu implementieren:
- K-Ziele & Jahresvergleich UI (‚ö†Ô∏è In Arbeit - Backend fertig, Frontend Modal fertig)
- Massnahmen-Verwaltung
- PDF-Upload Funktionalit√§t
- Tests (30% Coverage)
- Environment Setup vervollst√§ndigen
- E-Mail Benachrichtigungen

### UPDATE 2025-07-30, 23:45
- Status: Task 2.2 (K-Ziele & Jahresvergleich UI) ABGESCHLOSSEN ‚úÖ
- Fortschritt: 100%
- Implementierte √Ñnderungen:
  - Modals f√ºr K-Ziele und Jahresvergleich in gesuch-verwaltung.html erstellt
  - JavaScript-Funktionen f√ºr CRUD-Operationen implementiert
  - Dynamische Formular-Zeilen mit Add/Remove-Funktionalit√§t
  - Backend-Endpoints angepasst f√ºr leere Arrays
  - Datenbank-Migrations verifiziert (jahresvergleich Tabelle existiert)
  - Axios-Dependency f√ºr Webhook-Service installiert
- Erfolgskriterien: ‚úÖ ERF√úLLT
  - [x] Admin kann K-Ziele f√ºr Gesuche verwalten
  - [x] Admin kann Jahresvergleiche erstellen
  - [x] Dynamische UI mit Add/Remove Funktionalit√§t
  - [x] Datenspeicherung im Backend funktionsf√§hig